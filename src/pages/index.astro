---
import Layout from "@/layouts/Layout.astro";
---

<Layout title="Calculadora de Precios - Sabor del Campo">
  <div class="mx-auto max-w-6xl p-6">
    <!-- Encabezado -->
    <header class="mb-8 text-center">
      <div class="mb-4 text-6xl">ðŸ§®</div>
      <h2 class="mb-2 text-4xl font-bold text-gray-800">
        Calculadora de Precios
      </h2>
      <p class="text-lg text-gray-600">
        Calcula el precio de venta y gestiona descuentos para tu tienda
      </p>
    </header>

    <!-- Main Calculator Card -->
    <div class="mx-auto max-w-2xl rounded-2xl bg-white p-8 shadow-xl">
      <h2 class="mb-6 text-center text-2xl font-semibold text-gray-800">
        Calculadora de Precios
      </h2>

      <!-- Calculator Form -->
      <form id="calculator-form" class="space-y-6">
        <!-- Precio de Costo -->
        <div>
          <label
            for="cost-price"
            class="mb-2 block text-sm font-medium text-gray-700"
          >
            Precio de Costo (â‚¬)
          </label>
          <input
            type="number"
            id="cost-price"
            step="0.01"
            min="0"
            class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:border-transparent focus:ring-2 focus:ring-green-500"
            placeholder="Ingrese el precio de costo"
          />
        </div>

        <!-- Porcentaje de Ganancia -->
        <div>
          <label
            for="profit-percentage"
            class="mb-2 block text-sm font-medium text-gray-700"
          >
            Porcentaje de Ganancia (%)
          </label>
          <input
            type="number"
            id="profit-percentage"
            step="0.1"
            value="20"
            min="0"
            class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:border-transparent focus:ring-2 focus:ring-green-500"
            placeholder="Ingrese el porcentaje de ganancia"
          />
        </div>

        <!-- Botones de CÃ¡lculo -->
        <div class="mx-auto text-center">
          <button
            type="button"
            id="calculate-sale-price"
            class="rounded-lg bg-green-600 px-6 py-3 font-semibold text-white transition duration-200 hover:bg-green-700"
          >
            Calcular Precio de Venta
          </button>
          <!-- <button
              type="button"
              id="calculate-discount"
              class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200"
            >
              Calcular con Descuento
            </button> -->
        </div>

        <!-- Campo de Descuento (inicialmente oculto) -->
        <div id="discount-section" class="hidden">
          <label
            for="discount-percentage"
            class="mb-2 block text-sm font-medium text-gray-700"
          >
            Porcentaje de Descuento (%)
          </label>
          <input
            type="number"
            id="discount-percentage"
            step="0.1"
            min="0"
            max="100"
            class="w-full rounded-lg border border-gray-300 px-4 py-3 focus:border-transparent focus:ring-2 focus:ring-blue-500"
            placeholder="Ingrese el porcentaje de descuento"
          />
        </div>
      </form>

      <!-- Results Section -->
      <div id="results" class="mt-8 hidden rounded-lg bg-gray-50 p-6">
        <h3 class="mb-4 text-lg font-semibold text-gray-800">Resultados:</h3>
        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <span class="text-gray-600">Precio de Costo:</span>
            <span id="result-cost" class="font-semibold text-gray-800"
              >$0.00</span
            >
          </div>
          <div class="flex items-center justify-between">
            <span class="text-gray-600">Ganancia:</span>
            <span id="result-profit" class="font-semibold text-green-600"
              >$0.00</span
            >
          </div>
          <div class="flex items-center justify-between">
            <span class="text-gray-600">Precio de Venta:</span>
            <span id="result-sale-price" class="font-semibold text-blue-600"
              >$0.00</span
            >
          </div>
          <div id="discount-result" class="hidden">
            <div class="flex items-center justify-between">
              <span class="text-gray-600">Descuento:</span>
              <span id="result-discount" class="font-semibold text-red-600"
                >$0.00</span
              >
            </div>
            <div class="flex items-center justify-between border-t pt-2">
              <span class="font-semibold text-gray-800">Precio Final:</span>
              <span
                id="result-final-price"
                class="text-lg font-bold text-green-700">$0.00</span
              >
            </div>
          </div>
        </div>
      </div>

      <!-- Clear Button -->
      <div class="mt-6 text-center">
        <button
          type="button"
          id="clear-form"
          class="rounded-lg bg-gray-500 px-6 py-2 font-semibold text-white transition duration-200 hover:bg-gray-600"
        >
          Limpiar
        </button>
      </div>
    </div>

    <!-- Info Cards -->
    <div class="mx-auto mt-12 grid max-w-4xl grid-cols-1 gap-6 md:grid-cols-3">
      <div class="rounded-lg bg-white p-6 text-center shadow-md">
        <div class="mb-3 text-3xl">ðŸ“Š</div>
        <h3 class="mb-2 font-semibold text-gray-800">CÃ¡lculo Preciso</h3>
        <p class="text-sm text-gray-600">
          Calcula precios de venta con mÃ¡rgenes de ganancia exactos
        </p>
      </div>
      <div class="rounded-lg bg-white p-6 text-center shadow-md">
        <div class="mb-3 text-3xl">ðŸ’°</div>
        <h3 class="mb-2 font-semibold text-gray-800">GestiÃ³n de Descuentos</h3>
        <p class="text-sm text-gray-600">
          Aplica descuentos y visualiza el impacto en tus ganancias
        </p>
      </div>
      <div class="rounded-lg bg-white p-6 text-center shadow-md">
        <div class="mb-3 text-3xl">ðŸŽ¯</div>
        <h3 class="mb-2 font-semibold text-gray-800">FÃ¡cil de Usar</h3>
        <p class="text-sm text-gray-600">
          Interface intuitiva para cÃ¡lculos rÃ¡pidos y eficientes
        </p>
      </div>
    </div>
  </div>

  <script>
    // Elementos del DOM
    const costPriceInput = document.getElementById("cost-price");
    const profitPercentageInput = document.getElementById("profit-percentage");
    const discountPercentageInput = document.getElementById(
      "discount-percentage",
    );
    const calculateSalePriceBtn = document.getElementById(
      "calculate-sale-price",
    );
    const calculateDiscountBtn = document.getElementById("calculate-discount");
    const clearFormBtn = document.getElementById("clear-form");
    const discountSection = document.getElementById("discount-section");
    const resultsSection = document.getElementById("results");
    const discountResult = document.getElementById("discount-result");

    // Elementos de resultados
    const resultCost = document.getElementById("result-cost");
    const resultProfit = document.getElementById("result-profit");
    const resultSalePrice = document.getElementById("result-sale-price");
    const resultDiscount = document.getElementById("result-discount");
    const resultFinalPrice = document.getElementById("result-final-price");

    // FunciÃ³n para formatear moneda
    function formatCurrency(amount) {
      return new Intl.NumberFormat("es-CO", {
        style: "currency",
        currency: "EUR",
        minimumFractionDigits: 0,
        maximumFractionDigits: 2,
      }).format(amount);
    }

    // FunciÃ³n para calcular precio de venta
    function calculateSalePrice() {
      const costPrice = parseFloat(costPriceInput.value) || 0;
      const profitPercentage = parseFloat(profitPercentageInput.value) || 0;

      if (costPrice <= 0) {
        alert("Por favor ingrese un precio de costo vÃ¡lido");
        return;
      }

      if (profitPercentage < 0) {
        alert("El porcentaje de ganancia no puede ser negativo");
        return;
      }

      const profit = costPrice * (profitPercentage / 100);
      const salePrice = costPrice + profit;

      // Mostrar resultados
      resultCost.textContent = formatCurrency(costPrice);
      resultProfit.textContent = formatCurrency(profit);
      resultSalePrice.textContent = formatCurrency(salePrice);

      resultsSection.classList.remove("hidden");
      discountResult.classList.add("hidden");
      discountSection.classList.add("hidden");
    }

    // FunciÃ³n para calcular con descuento
    function calculateWithDiscount() {
      const costPrice = parseFloat(costPriceInput.value) || 0;
      const profitPercentage = parseFloat(profitPercentageInput.value) || 0;
      const discountPercentage = parseFloat(discountPercentageInput.value) || 0;

      if (costPrice <= 0) {
        alert("Por favor ingrese un precio de costo vÃ¡lido");
        return;
      }

      if (profitPercentage < 0) {
        alert("El porcentaje de ganancia no puede ser negativo");
        return;
      }

      if (discountPercentage < 0 || discountPercentage > 100) {
        alert("El porcentaje de descuento debe estar entre 0 y 100");
        return;
      }

      const profit = costPrice * (profitPercentage / 100);
      const salePrice = costPrice + profit;
      const discount = salePrice * (discountPercentage / 100);
      const finalPrice = salePrice - discount;

      // Mostrar resultados
      resultCost.textContent = formatCurrency(costPrice);
      resultProfit.textContent = formatCurrency(profit);
      resultSalePrice.textContent = formatCurrency(salePrice);
      resultDiscount.textContent = formatCurrency(discount);
      resultFinalPrice.textContent = formatCurrency(finalPrice);

      resultsSection.classList.remove("hidden");
      discountResult.classList.remove("hidden");
    }

    // FunciÃ³n para mostrar secciÃ³n de descuento
    function showDiscountSection() {
      discountSection.classList.remove("hidden");
    }

    // FunciÃ³n para limpiar formulario
    function clearForm() {
      costPriceInput.value = "";
      profitPercentageInput.value = "20";
      discountPercentageInput.value = "";
      resultsSection.classList.add("hidden");
      discountSection.classList.add("hidden");
      discountResult.classList.add("hidden");
    }

    // Event listeners
    calculateSalePriceBtn.addEventListener("click", calculateSalePrice);
    //   calculateDiscountBtn.addEventListener("click", () => {
    //     showDiscountSection();
    //     calculateWithDiscount();
    //   });
    clearFormBtn.addEventListener("click", clearForm);

    // Permitir cÃ¡lculo con Enter en los inputs
    [costPriceInput, profitPercentageInput].forEach((input) => {
      input.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          calculateSalePrice();
        }
      });
    });

    discountPercentageInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        calculateWithDiscount();
      }
    });
  </script>
</Layout>
